<div class="container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <mat-icon>trending_up</mat-icon>
        Mis Metas de Venta
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <!-- Sección de Filtros -->
      <div class="filter-section">
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Región</mat-label>
          <mat-select [formControl]="regionControl">
            <mat-option value="">Todas</mat-option>
            @for (region of regiones; track region) {
              <mat-option [value]="region">{{ region }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Trimestre</mat-label>
          <mat-select [formControl]="trimestreControl">
            <mat-option value="">Todos</mat-option>
            @for (trimestre of trimestres; track trimestre) {
              <mat-option [value]="trimestre">{{ trimestre }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Tipo</mat-label>
          <mat-select [formControl]="tipoControl">
            <mat-option value="">Todos</mat-option>
            @for (tipo of tipos; track tipo) {
              <mat-option [value]="tipo">{{ getTipoDisplay(tipo) }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <button mat-raised-button (click)="limpiarFiltros()" class="clear-filters-btn">
          <mat-icon>clear</mat-icon>
          Limpiar
        </button>
      </div>

      <!-- Contador de resultados -->
      @if (!loading() && !errorMessage() && metas().length > 0) {
        <div class="results-count">
          Mostrando {{ metasFiltradas().length }} de {{ metas().length }} metas
        </div>
      }

      @if (loading()) {
        <div class="loading-container">
          <mat-spinner></mat-spinner>
          <p>Cargando metas...</p>
        </div>
      } @else if (errorMessage()) {
        <div class="error-message">
          <mat-icon>error</mat-icon>
          <span>{{ errorMessage() }}</span>
        </div>
      } @else if (metasFiltradas().length === 0 && metas().length === 0) {
        <div class="empty-state">
          <mat-icon>assessment</mat-icon>
          <p>No tienes metas de venta asignadas</p>
        </div>
      } @else if (metasFiltradas().length === 0 && metas().length > 0) {
        <div class="empty-state">
          <mat-icon>filter_list_off</mat-icon>
          <p>No hay metas que coincidan con los filtros seleccionados</p>
          <button mat-raised-button color="primary" (click)="limpiarFiltros()">
            <mat-icon>clear</mat-icon>
            Limpiar Filtros
          </button>
        </div>
      } @else {
        <div class="metas-grid">
          @for (meta of metasFiltradas(); track meta.id) {
            <mat-card class="meta-card">
              <mat-card-content>
                <div class="meta-header">
                  <h3>{{ getProductoDisplay(meta) }}</h3>
                  <mat-chip [class]="meta.tipo === TipoMeta.UNIDADES ? 'tipo-unidades' : 'tipo-monetario'">
                    {{ getTipoDisplay(meta.tipo) }}
                  </mat-chip>
                </div>
                
                <div class="meta-details">
                  <div class="detail-item">
                    <mat-icon>place</mat-icon>
                    <span><strong>Región:</strong> {{ meta.region }}</span>
                  </div>
                  
                  <div class="detail-item">
                    <mat-icon>calendar_today</mat-icon>
                    <span><strong>Trimestre:</strong> {{ meta.trimestre }}</span>
                  </div>
                  
                  <div class="detail-item">
                    <mat-icon>track_changes</mat-icon>
                    <span><strong>Objetivo:</strong> {{ getValorDisplay(meta) }}</span>
                  </div>
                </div>

                <!-- Barra de progreso (placeholder - se puede conectar con ventas reales) -->
                <div class="progress-section">
                  <div class="progress-header">
                    <span>Progreso</span>
                    <span class="progress-value">0%</span>
                  </div>
                  <mat-progress-bar mode="determinate" [value]="0"></mat-progress-bar>
                </div>
              </mat-card-content>
            </mat-card>
          }
        </div>
      }
    </mat-card-content>
  </mat-card>
</div>
