<div class="container">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <div style="display: flex; align-items: center; gap: 16px;">
      <a mat-icon-button [routerLink]="['/dashboard-admin']">
        <mat-icon>arrow_back</mat-icon>
      </a>
      <h2 style="margin: 0;">Definición de metas de venta</h2>
    </div>
    <button mat-raised-button color="primary" (click)="agregarMeta()">
      <mat-icon>add</mat-icon>
      Agregar Meta
    </button>
  </div>

<div class="search-bar" style="flex: 1;">
    <div class="search-wrap">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Buscar metas</mat-label>
        <input matInput
              placeholder="Producto, región, trimestre o responsable..."
              [(ngModel)]="filtroBusqueda"
              (keyup.enter)="filtrarMetas()" />

        <button *ngIf="filtroBusqueda"
                matSuffix
                mat-icon-button
                aria-label="Limpiar"
                (click)="filtroBusqueda=''">
          <mat-icon>close</mat-icon>
        </button>

        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
<!-- botón al costado (Opción 1) -->
    <button mat-raised-button
            color="primary"
            class="search-btn"
            (click)="filtrarMetas()">
      <mat-icon>search</mat-icon>
    </button>
  </div>
</div>

  

  <div class="card">
    <table class="modern-table">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Región</th>
          <th>Trimestre</th>
          <th>Valor objetivo</th>
          <th>Tipo</th>
          <th>Responsable</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let meta of metasFiltradas">
          <td>{{ meta.producto }}</td>
          <td>{{ meta.region }}</td>
          <td>{{ meta.trimestre }}</td>
          <td>{{ meta.valorObjetivo }}</td>
          <td>{{ meta.tipo }}</td>
          <td>{{ meta.usuarioResponsable }}</td>
          <td class="actions">
            <button class="btn-icon" title="Ver" (click)="verMeta(meta)"><i class="fas fa-eye"></i></button>
            <button class="btn-icon" title="Editar" [disabled]="!meta.editable" (click)="editarMeta(meta)"><i class="fas fa-edit"></i></button>
            <button class="btn-icon danger" title="Eliminar" (click)="eliminarMeta(meta)"><i class="fas fa-trash"></i></button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal Detalle -->
  <div class="modal" [ngStyle]="{display: mostrarDetalle ? 'flex' : 'none'}">
    <div class="modal-content" *ngIf="metaDetalle">
      <span class="close" (click)="cerrarDetalle()">&times;</span>
      <h2>Detalle de la Meta</h2>
      <p><strong>Producto:</strong> {{ metaDetalle.producto }}</p>
      <p><strong>Región:</strong> {{ metaDetalle.region }}</p>
      <p><strong>Trimestre:</strong> {{ metaDetalle.trimestre }}</p>
      <p><strong>Valor objetivo:</strong> {{ metaDetalle.valorObjetivo }}</p>
      <p><strong>Tipo:</strong> {{ metaDetalle.tipo }}</p>
      <p><strong>Responsable:</strong> {{ metaDetalle.usuarioResponsable }}</p>
      <p><strong>Fecha de creación:</strong> {{ metaDetalle.fechaCreacion | date:'short' }}</p>
    </div>
  </div>

  <!-- Modal Edición/Creación -->
  <div class="modal" [ngStyle]="{display: mostrarModal ? 'flex' : 'none'}">
    <div class="modal-content" *ngIf="metaEditando">
      <span class="close" (click)="cancelarEdicion()">&times;</span>
      <h2>{{ modoEdicion ? 'Editar Meta' : 'Agregar Meta' }}</h2>
      <form (ngSubmit)="guardarMeta()">
        <label>Producto</label>
        <select [(ngModel)]="metaEditando.producto" name="producto" required>
          <option value="" disabled>Seleccione...</option>
          <option *ngFor="let p of productos" [value]="p">{{ p }}</option>
        </select>
        <label>Región</label>
        <select [(ngModel)]="metaEditando.region" name="region" required>
          <option value="" disabled>Seleccione...</option>
          <option *ngFor="let r of regiones" [value]="r">{{ r }}</option>
        </select>
        <label>Trimestre</label>
        <select [(ngModel)]="metaEditando.trimestre" name="trimestre" required>
          <option value="" disabled>Seleccione...</option>
          <option *ngFor="let t of trimestres" [value]="t">{{ t }}</option>
        </select>
        <label>Valor objetivo</label>
        <input type="number" [(ngModel)]="metaEditando.valorObjetivo" name="valorObjetivo" min="1" required>
        <label>Tipo</label>
        <select [(ngModel)]="metaEditando.tipo" name="tipo" required>
          <option value="unidades">Unidades</option>
          <option value="monetario">Monetario</option>
        </select>
        <button type="submit" class="btn-primary">Guardar</button>
      </form>
    </div>
  </div>
</div>
